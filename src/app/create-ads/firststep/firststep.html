<div class="container">
  <!-- Form Section -->
  <div class="form-section">
    <h2>Đặt giá quảng cáo (1/3)</h2>

    <!-- Buy/Sell Tabs -->
    <div class="field">
      <label>Tôi muốn</label>
      <div class="tab">
        <button [class.active]="selectedTab === 'buy'" (click)="selectTab('buy')">Mua</button>
        <button [class.active]="selectedTab === 'sell'" (click)="selectTab('sell')">Bán</button>
      </div>
    </div>

    <!-- Crypto and Fiat Selection -->
    <div class="field-row horizontal">
      <div class="field dropdown" [class.open]="dropdownOpen === 'coin'" (click)="$event.stopPropagation()">
        <label>Tiền mã hóa</label>
        <button class="dropdown-btn" (click)="toggleDropdown('coin')">
          <img *ngIf="selectedCoin.icon" [src]="selectedCoin.icon" class="icon" />
          {{ selectedCoin.name }}
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"
            class="chevron" [class.open]="dropdownOpen === 'coin'">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"></path>
          </svg>
        </button>

        <div class="dropdown-menu" *ngIf="dropdownOpen === 'coin'">
          <input type="text" #searchCoinInput [value]="searchCoin" (input)="onSearch('coin', searchCoinInput.value)"
            placeholder="Tìm kiếm" class="search-box" (click)="$event.stopPropagation()" />
          <div class="dropdown-item" *ngFor="let coin of filteredCoinList" (click)="selectCoin(coin)">
            <img [src]="coin.icon" class="icon" />
            {{ coin.name }}
            <span *ngIf="coin.name === selectedCoin.name">✔</span>
          </div>
        </div>
      </div>

      <div class="field dropdown" (click)="$event.stopPropagation()" [class.open]="dropdownOpen === 'currency'">
        <label>Cho</label>
        <button class="dropdown-btn" (click)="toggleDropdown('currency')">
          <img *ngIf="selectedCurrency.icon" [src]="selectedCurrency.icon" class="icon" />
          {{ selectedCurrency.name }}
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"
            class="chevron" [class.open]="dropdownOpen === 'currency'">
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"></path>
          </svg>
        </button>
        <div class="dropdown-menu" *ngIf="dropdownOpen === 'currency'">
          <input type="text" #searchCurrencyInput [value]="searchCurrency"
            (input)="onSearch('currency', searchCurrencyInput.value)" placeholder="Tìm kiếm" class="search-box"
            (click)="$event.stopPropagation()" />
          <div class="dropdown-item" *ngFor="let currency of filteredCurrencyList" (click)="selectCurrency(currency)">
            <img [src]="currency.icon" class="icon" />
            {{ currency.name }}
            <span *ngIf="currency.name === selectedCurrency.name">✔</span>
          </div>
        </div>
      </div>
    </div>

    <!-- Price Type -->
    <div class="field dropdown" (click)="$event.stopPropagation()">
      <label>Loại giá</label>
      <button class="dropdown-btn" (click)="toggleDropdown('priceType')">
        <span>{{ selectedPriceType.label }}</span>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"
          class="chevron" [class.open]="dropdownOpen === 'priceType'">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"></path>
        </svg>
      </button>
      <div class="dropdown-menu" *ngIf="dropdownOpen === 'priceType'">
        <div class="dropdown-item has-description" *ngFor="let type of priceTypes" (click)="selectPriceType(type)">
          <div class="item-title">{{ type.label }}</div>
          <div class="item-desc">{{ type.description }}</div>
        </div>
      </div>
    </div>

    <!-- Unit Price -->
    <div class="field">
      <label>Đơn giá</label>
      <div class="limit-input">
        <input type="number" [(ngModel)]="price" (ngModelChange)="validateInput('price', $event)" placeholder="26.135"
          min="0" />
        <span class="unit">VND</span>
      </div>
      <small class="note">
        Giá tối thiểu - tối đa 22.219 VND - 30.081 VND<br />
        Giá thị trường 26.140 VND<br />
        Giá cao nhất hiện tại trên sàn giao dịch 26.337 VND
      </small>
    </div>

    <!-- Amount -->
    <div class="field">
      <label>Số lượng</label>
      <div class="limit-input">
        <input type="number" [(ngModel)]="amount" (ngModelChange)="validateInput('amount', $event)" placeholder="100"
          min="0" />
        <span class="unit">USDT</span>
      </div>
    </div>

    <!-- Order Limit -->
    <div class="field limit-range">
      <label>Hạn mức giao dịch đơn lẻ <span class="info-icon">ⓘ</span></label>
      <div class="limit-input-group">
        <div class="limit-input">
          <span class="limit-label">Tối thiểu</span>
          <input type="number" [(ngModel)]="minLimit" (ngModelChange)="validateInput('minLimit', $event)" min="0" />
          <span class="unit">VND</span>
        </div>
        <div class="range-divider">~</div>
        <div class="limit-input">
          <span class="limit-label">Tối đa</span>
          <input type="number" [(ngModel)]="maxLimit" (ngModelChange)="validateInput('maxLimit', $event)" min="0" />
          <span class="unit">VND</span>
        </div>
      </div>
    </div>

    <!-- Market -->
    <div class="field dropdown" (click)="$event.stopPropagation()">
      <label>Thị trường</label>
      <button class="dropdown-btn" (click)="toggleDropdown('market')">
        <span>{{ selectedMarket.label }}</span>
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="3" stroke="currentColor"
          class="chevron" [class.open]="dropdownOpen === 'market'">
          <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 8.25l-7.5 7.5-7.5-7.5"></path>
        </svg>
      </button>
      <div class="dropdown-menu" *ngIf="dropdownOpen === 'market'">
        <div class="dropdown-item has-description" *ngFor="let option of marketOptions" (click)="selectMarket(option)">
          <div class="item-title">{{ option.label }}</div>
          <div class="item-desc">{{ option.description }}</div>
        </div>
      </div>
    </div>

    <button class="next-btn" (click)="NextStepPage()">Tiếp theo</button>
  </div>

  <!-- Preview Section -->
  <div class="preview-section">
    <h3>Xem trước quảng cáo {{ selectedTab === 'sell' ? 'bán' : 'mua' }}</h3>

    <div class="preview-info">
      <div class="preview-item">
        <span class="preview-label">Tiền mã hóa</span>
        <span class="preview-value crypto">
          <img *ngIf="selectedCoin.icon" [src]="selectedCoin.icon" width="16" />
          {{ selectedCoin.name }}
        </span>
      </div>
      <div class="preview-item">
        <span class="preview-label">Loại giá</span>
        <span class="preview-value">{{ selectedPriceType.label }}</span>
      </div>
      <div class="preview-item">
        <span class="preview-label">Đơn giá</span>
        <span class="preview-value">{{ price ? (price | number:'1.3-3') + ' VND' : '--' }}</span>
      </div>
      <div class="preview-item">
        <span class="preview-label">Số lượng</span>
        <span class="preview-value">{{ amount ? (amount | number:'1.2-2') + ' ' + selectedCoin.name : '--' }}</span>
      </div>
      <div class="preview-item">
        <span class="preview-label">Hạn mức giao dịch đơn lẻ</span>
        <span class="preview-value">{{ (minLimit ? (minLimit | number:'1.0-0') : '0') + ' - ' + (maxLimit ? (maxLimit |
          number:'1.0-0') : '0') + ' VND' }}</span>
      </div>
      <div class="preview-item">
        <span class="preview-label">Thị trường</span>
        <span class="preview-value">Công khai</span>
      </div>
      <div class="preview-item total">
        <span class="preview-label">Tổng số tiền</span>
        <span class="preview-value">{{ price && amount ? (price * amount | number:'1.2-2') + ' VND' : '0,00 VND'
          }}</span>
      </div>
      <div class="preview-item">
        <span class="preview-label">Phương thức thanh toán</span>
        <span class="preview-value">-</span>
      </div>
    </div>

    <div class="terms">
      <div class="preview-item">
        <span class="preview-label">Điều khoản giao dịch</span>
        <span class="preview-value terms-text">
          Vui lòng đảm bảo rằng tài khoản nhận khớp với tên tài khoản OKX đã xác minh của bạn. Bạn có thể liên hệ với
          tôi nếu gặp phải bất kỳ vấn đề nào trước khi khiếu nại.
        </span>
      </div>
      <div class="preview-item">
        <span class="preview-label">Tin nhắn chào mừng</span>
        <span class="preview-value terms-text">
          Đừng ngần ngại trò chuyện cùng tôi nếu bạn có bất kỳ thắc mắc nào liên quan đến lệnh
        </span>
      </div>
      <div class="preview-item">
        <span class="preview-label">Quy tắc giao dịch</span>
        <span class="preview-value terms-text">
          Thanh toán trong vòng 10 phút
        </span>
      </div>
    </div>
  </div>
</div>